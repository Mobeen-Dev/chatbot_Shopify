{{ 'chat.css' | asset_url | stylesheet_tag }}
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<div class="shop-ai-chat-container">
  <div class="shop-ai-chat-tooltip" id="shopAiTooltip">
    <p>Got any questions? Chat with helpline</p>
    <span class="tooltip-close-x">Ã—</span>
  </div>

  <div class="shop-ai-chat-bubble" style="background-color: {{ block.settings.chat_bubble_color }}">
    <span class="chat-notification-badge">1</span>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      width="24"
      height="24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
    </svg>
  </div>

  <div class="shop-ai-chat-window">
    <div class="shop-ai-chat-header">
      <div>{{ 'chat.title' | t }}</div>
      <div class="shop-ai-chat-actions">
        <!-- Deepthink toggle button -->
        <button class="shop-ai-chat-btn shop-ai-chat-deepthink" title="Deep Think">
          <img
            id="wobbleImage"
            src="{{ 'DeepThink2.svg' | asset_url }}"
            alt="Button Icon"
            class="whatsapp-button__image Animate"
            width="30"
            height="30"
            loading="lazy"
          >
          <span class="btn-text">Deep Thinking</span>
        </button>

        <!-- Clear Session button -->
        <button class="shop-ai-chat-btn shop-ai-chat-clear" title="Clear Session">
          <img
            id="wobbleImage"
            src="{{ 'ClearSession.svg' | asset_url }}"
            alt="Button Icon"
            class="whatsapp-button__image Animate"
            width="28"
            height="28"
            loading="lazy"
          >
          <span class="btn-text">Clear Session</span>
        </button>

        <!-- Close button -->
        <button class="shop-ai-chat-close" title="Close">âœ•</button>
      </div>
    </div>

    <div class="shop-ai-chat-messages">
      <!-- Messages will be added here by JavaScript -->
    </div>

    <div class="shop-ai-chat-input">
      <input type="text" placeholder="{{ 'chat.inputPlaceholder' | t }}">
      <button class="shop-ai-chat-send">
        <img
          id="Image"
          src="{{ 'send.png' | asset_url }}"
          alt="Button Icon"
          class="whatsapp-button__image Animate"
          width="26"
          height="26"
          loading="lazy"
        >
      </button>
    </div>
  </div>
</div>
<script>
    window.shopChatIcons = {
    copy: "{{ 'icon-copy.svg' | asset_url }}",
    check: "{{ 'icon-check.svg' | asset_url }}"
  };
    window.shopChatConfig = {
      promptType: {{ block.settings.system_prompt | json }},
      welcomeMessage: {{ block.settings.welcome_message | json }},
      url: "{{ block.settings.server_url }}"
    };
    window.shopId = {{ shop.id }};
</script>
<script>
  // Inside your bubble click listener
  document.querySelector('.chat-notification-badge').style.display = 'none';
  document.addEventListener('DOMContentLoaded', function () {
    const tooltip = document.getElementById('shopAiTooltip');
    const chatBubble = document.querySelector('.shop-ai-chat-bubble');
    const tooltipClose = document.querySelector('.tooltip-close-x');

    // Hide tooltip when clicking the chat bubble
    chatBubble.addEventListener('click', function () {
      tooltip.classList.add('hidden');
    });

    // Hide tooltip when clicking the 'X' on the tooltip
    tooltipClose.addEventListener('click', function (e) {
      e.stopPropagation(); // Prevents triggering the bubble click
      tooltip.classList.add('hidden');
    });

    // Optional: Auto-hide after 15 seconds if ignored
    setTimeout(() => {
      tooltip.classList.add('hidden');
    }, 15000);
  });
</script>
<script src="{{ 'chat.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "V3 Assistant",
  "target": "body",
  "settings": [
    {
      "type": "color",
      "id": "chat_bubble_color",
      "label": "Chat Bubble Color",
      "default": "#02B052"
    },
    {
      "type": "text",
      "id": "welcome_message",
      "label": "Welcome Message",
      "default": "ðŸ‘‹ Hi there! How can I help you today?"
    },
    {
      "type": "url",
      "id": "server_url",
      "label": "Server Link"
    },
    {
      "type": "range",
      "id": "temperature",
      "min": 0,
      "max": 2,
      "step": 0.1,
      "unit": "tmp",
      "label": "Model Temperature",
      "default": 1
    },
    {
      "type": "select",
      "id": "system_prompt",
      "label": "System Prompt",
      "options": [
        {
          "value": "standardAssistant",
          "label": "Standard Assistant"
        },
        {
          "value": "enthusiasticAssistant",
          "label": "Enthusiastic Assistant"
        }
      ],
      "default": "standardAssistant"
    }
  ]
}
{% endschema %}
